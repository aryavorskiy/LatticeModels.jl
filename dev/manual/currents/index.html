<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Currents · LatticeModels.jl</title><meta name="title" content="Currents · LatticeModels.jl"/><meta property="og:title" content="Currents · LatticeModels.jl"/><meta property="twitter:title" content="Currents · LatticeModels.jl"/><meta name="description" content="Documentation for LatticeModels.jl."/><meta property="og:description" content="Documentation for LatticeModels.jl."/><meta property="twitter:description" content="Documentation for LatticeModels.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="LatticeModels.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LatticeModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../examples/">Examples</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../lattice/">Defining the lattice</a></li><li><a class="tocitem" href="../bonds/">Adding bonds</a></li><li><a class="tocitem" href="../latticevalue/">Working with &#39;LatticeValue&#39;s</a></li><li><a class="tocitem" href="../hamiltonian/">Constructing the Hamiltonian</a></li><li><a class="tocitem" href="../operators/">States and Operators</a></li><li><a class="tocitem" href="../greenfunction/">Green&#39;s function</a></li><li class="is-active"><a class="tocitem" href>Currents</a><ul class="internal"><li><a class="tocitem" href="#Basics"><span>Basics</span></a></li><li><a class="tocitem" href="#Common-Operations"><span>Common Operations</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li></ul></li><li><a class="tocitem" href="../evolution/">Evolution</a></li></ul></li><li><a class="tocitem" href="../../library/">API</a></li><li><a class="tocitem" href="../../internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Currents</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Currents</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/aryavorskiy/LatticeModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/aryavorskiy/LatticeModels.jl/blob/master/docs/src/manual/currents.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Currents_chapter"><a class="docs-heading-anchor" href="#Currents_chapter">Currents</a><a id="Currents_chapter-1"></a><a class="docs-heading-anchor-permalink" href="#Currents_chapter" title="Permalink"></a></h1><p>This chapter covers the calculation of currents in the system.</p><h2 id="Basics"><a class="docs-heading-anchor" href="#Basics">Basics</a><a id="Basics-1"></a><a class="docs-heading-anchor-permalink" href="#Basics" title="Permalink"></a></h2><p>An <code>AbstractCurrents</code> object is a collection of currents of some nature (e.g. charge, spin, etc.) from one site to another.  In most cases it is a lazy object that doesn&#39;t store the currents themselves, but rather the parameters to evaluate them on the go.</p><p>A good example of this is <a href="../../library/#LatticeModels.DensityCurrents"><code>DensityCurrents</code></a>, which calculates the charge currents between sites.</p><pre><code class="language-julia hljs">using LatticeModels, Plots
l = SquareLattice(10, 10)
H = tightbinding_hamiltonian(l)
P = densitymatrix(H, statistics=FermiDirac, mu=0)
H1 = tightbinding_hamiltonian(l, field=PointFlux(0.1, (5.5, 5.5)))
C = DensityCurrents(H1, P)
plot(C)</code></pre><img src="3983fd27.svg" alt="Example block output"/><p>Here we find the density matrix <code>P</code> of the system, add a magnetic field to the Hamiltonian to induce currents (<code>H1</code>), and calculate the charge currents between sites (<code>C</code>). The resulting plot shows the currents between sites.</p><p>Currents can be indexed with sites to get the currents between them:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; site1 = l[!, x=1, y=1]; site2 = l[!, x=1, y=2]; site3 = l[!, x=1, y=3];</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; C[site1, site2]</code><code class="nohighlight hljs ansi" style="display:block;">-0.007078986147809262</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; C[site1, site3]         # Current between site1 and site3 is zero</code><code class="nohighlight hljs ansi" style="display:block;">0.0</code></pre><p>You can evaluate all currents at once by converting the currents object to <a href="../../library/#LatticeModels.Currents"><code>Currents</code></a>. This can be useful when you want to perform non-trivial operations on the currents:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; C1 = Currents(C)</code><code class="nohighlight hljs ansi" style="display:block;">Currents{SparseArrays.SparseMatrixCSC{Float64, Int64}} on 100-site SquareLattice in 2D space</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; C1[site1, site2] == C[site1, site2]</code><code class="nohighlight hljs ansi" style="display:block;">true</code></pre><p>Also note that the <code>Currents</code> object is writable:</p><pre><code class="language-julia hljs">site4 = l[!, x=2, y=2]
C1[site1, site4] = 0.05
C1[l[!, x=10, y=10], l[!, x=9, y=9]] = 0.05
plot(C1)</code></pre><img src="5f6a4a07.svg" alt="Example block output"/><h2 id="Common-Operations"><a class="docs-heading-anchor" href="#Common-Operations">Common Operations</a><a id="Common-Operations-1"></a><a class="docs-heading-anchor-permalink" href="#Common-Operations" title="Permalink"></a></h2><p>One function you may find useful is <a href="../../library/#LatticeModels.currentsfromto"><code>currentsfromto</code></a>, which calculates currents between two sites or other domains. As an example, let&#39;s find how the currents through a circular sample depends on time:</p><pre><code class="language-julia hljs">using LatticeModels, Plots
l = SquareLattice{2}(Circle(10), !Circle(5))
h(t) = tightbinding_hamiltonian(l, field=PointFlux(0.1 * t, (0, 0)))
P = densitymatrix(h(0), statistics=FermiDirac, mu=0)
τ = 10
ev = Evolution(t -&gt; h(min(t, τ)), P)
dom1 = l[x = 0 .. Inf, y = 0]
dom2 = l[x = 0 .. Inf, y = 1]
currs = TimeSequence(ev, 0:0.1:2τ) do (Pt, Ht, t)
    Currents(DensityCurrents(Ht, Pt))    # Convert to Currents, since P is reused
end
currs_from_to = map(curr -&gt; currentsfromto(curr, dom1, dom2), currs)
plot(currs_from_to, title=&quot;Currents through the circle&quot;)</code></pre><img src="72158f8b.svg" alt="Example block output"/><p>Here we perform a time evolution of the system with a magnetic field that is slowly increasing from 0 to <code>0.1 * τ</code>, after which it remains constant. See the <a href="../evolution/#Evolution_chapter">Evolution</a> chapter for more details about time evolution.</p><p>The value we evaluated is the currents between two domains <code>dom1</code> and <code>dom2</code> at each time step. Here are  the domains:</p><pre><code class="language-julia hljs">C = currs[τ]
plot(C)
plot!(dom1, label=&quot;Domain 1&quot;)
plot!(dom2, label=&quot;Domain 2&quot;)</code></pre><img src="6c78f312.svg" alt="Example block output"/><p>Another useful function is <a href="../../library/#LatticeModels.currentsfrom-Tuple{LatticeModels.AbstractCurrents, Any}"><code>currentsfrom</code></a>, which calculates currents from a given domain (site or part of the lattice) to the rest of the lattice and returns a <a href="../../library/#LatticeValue"><code>LatticeValue</code></a> object.</p><p>Let us continue with the previous example. This will calculate the currents from <code>site1</code> in the bottom-left corner to the rest of the lattice:</p><pre><code class="language-julia hljs">site = l[!, x = -7, y = 2]
heatmap(currentsfrom(C, site), c=:balance, clims=(-0.06, 0.06))
plot!(site, label=&quot;&quot;, title=&quot;Currents from site $(site.coords)&quot;)</code></pre><img src="4ca16fc7.svg" alt="Example block output"/><p>Also note that currents are iterable objects, yielding a tuple of <code>source =&gt; target</code> pair and the current value.  The order of the sites is such that the current is directed from the source to the target and is always positive. This can be useful to analyze, for example, the direction of the currents:</p><pre><code class="language-julia hljs">cs = zeros(4)
ns = zeros(Int, 4)
for ((src, tgt), curr) in C
    @assert curr &gt;= 0
    curr &lt; 1e-6 &amp;&amp; continue
    x, y = normalize(tgt.coords - src.coords)
    angle = atan(y, x)
    idx = mod(round(Int, angle / (π / 2)), 4) + 1
    cs[idx] += curr
    ns[idx] += 1
end
bar([&quot;0&quot;, &quot;π/2&quot;, &quot;π&quot;, &quot;3π/2&quot;], cs ./ ns, label=&quot;Average current by direction&quot;)</code></pre><img src="e79f79c5.svg" alt="Example block output"/><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>The currents can be visualized using the <code>plot</code> function. The values of the currents will be shown as arrows between the sites. The color of the arrows represents the magnitude of the currents. Also note that the opacity of the arrows is also proportional to the magnitude of the currents, which can be disabled by setting <code>arrowtransparency=false</code>. You can customize the appearance of the arrows using the <code>arrowheadsize</code> and <code>arrowheadwidth</code> keywords.</p><p>Here we will continue with the <code>C</code> currents obtained in the previous example:</p><pre><code class="language-julia hljs">p = plot(layout = @layout[a b; _ c{0.5w} _], size=(1000, 1000))
plot!(p[1], C, title=&quot;Default&quot;)
plot!(p[2], C, arrowtransparency=false, title=&quot;Opaque arrows&quot;)
plot!(p[3], C, arrowheadsize=0.3, arrowheadwidth=1, arrowtransparency=false,
    title=&quot;Custom arrowhead&quot;)</code></pre><img src="dc2d63de.svg" alt="Example block output"/><p>You can plot an <code>AbstractCurrents</code> and a <code>LatticeValue</code> object in one axes. However, due to Plots.jl limitations, both series must share the same colorbar. You can bypass this by plotting them on separate axes, or by plotting the currents with a single color. In this case you need to set <code>line_z=nothing</code> to disable the colorbar for the arrows. Here is an example of plotting the currents and the lattice together:</p><pre><code class="language-julia hljs">plot(localdensity(P), st=:shape)
plot!(C, c=:pink2, arrowheadsize=0.3, arrowheadwidth=0.6, line_z=nothing)</code></pre><img src="345c338c.svg" alt="Example block output"/><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><p>To make the plot more readable and even almost artistic, keep in mind that the arrows should be of similar hue, but different brightness compared to the background. This can be achieved by setting the arrows color to one that fits the background color palette.</p></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../greenfunction/">« Green&#39;s function</a><a class="docs-footer-nextpage" href="../evolution/">Evolution »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 23 September 2024 00:59">Monday 23 September 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
